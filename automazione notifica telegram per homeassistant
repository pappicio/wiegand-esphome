alias: Notifica Telegram Accesso Wiegand
description: Notifica se accesso è autorizzato o negato per password, badge o impronta
trigger:
  - entity_id:
      - sensor.apriporte_wiegand_user_name
      - sensor.apriporte_wiegand_ultima_password_non_valida
      - sensor.apriporte_wiegand_ultimo_tag_o_impronta_non_valido
    platform: state
condition:
  - condition: template
    value_template: "{{ trigger.to_state.state not in ['', 'unknown', 'unavailable'] }}"
action:
  - data:
      title: >-
        {% if trigger.entity_id == 'sensor.apriporte_wiegand_user_name' %}
          ✅ Accesso autorizzato
        {% else %}
          🔐 Accesso negato!
        {% endif %}
      message: >-
        {% if trigger.entity_id == 'sensor.apriporte_wiegand_user_name' %}
          👤 Utente autorizzato: {{ trigger.to_state.state }}
        {% elif trigger.entity_id == 'sensor.apriporte_wiegand_ultima_password_non_valida' %}
          ❌ Password non valida: {{ trigger.to_state.state }}
        {% elif trigger.entity_id == 'sensor.apriporte_wiegand_ultimo_tag_o_impronta_non_valido' %}
          ❌ Badge o impronta non validi: {{ trigger.to_state.state }}
        {% else %}
          ⚠️ Tentativo di accesso non autorizzato.
        {% endif %}
    service: notify.telegram
mode: single
