alias: Notifica Telegram Accesso Wiegand
description: Notifica se accesso è autorizzato o negato per password, badge o impronta
triggers:
  - entity_id:
      - sensor.apriporte_wiegand_ultimo_accesso
      - sensor.apriporte_wiegand_ultima_password_non_valida
      - sensor.apriporte_wiegand_ultimo_tag_o_impronta_non_valido
    trigger: state
conditions:
  - condition: template
    value_template: "{{ trigger.to_state.state not in ['', 'unknown', 'unavailable'] }}"
actions:
  - data:
      title: |-
        {% if trigger.entity_id == 'sensor.apriporte_wiegand_ultimo_accesso' %}
          ✅ Accesso autorizzato
        {% else %}
          🔐 Accesso negato!
        {% endif %}
      message: >-
        {% if trigger.entity_id == 'sensor.apriporte_wiegand_ultimo_accesso' %}
          👤 Utente autorizzato: {{ trigger.to_state.state }}
        {% elif trigger.entity_id ==
        'sensor.apriporte_wiegand_ultima_password_non_valida' %}
          ❌ Password non valida: {{ trigger.to_state.state }}
        {% elif trigger.entity_id ==
        'sensor.apriporte_wiegand_ultimo_tag_o_impronta_non_valido' %}
          ❌ Badge o impronta non validi: {{ trigger.to_state.state }}
        {% else %}
          ⚠️ Tentativo di accesso non autorizzato.
        {% endif %}
    action: notify.telegram
mode: single

